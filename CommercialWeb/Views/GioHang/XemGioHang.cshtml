@using CommercialWeb.Models;
@model List<ItemGioHang>
@{
    ViewBag.Title = "XemGioHang";
    Layout = "~/Views/Layout/CartLayout.cshtml";
}

@if(Model.Count == 0)
{
    <!-- shopping-cart start -->
    <div class="tab-pane active" id="shopping-cart">
        <div class="shopping-cart-content">
            <form action="#">
                <div class="table-content table-responsive mb-50">
                    <table class="text-center">
                        <thead>
                            <tr>
                                <th class="product-thumbnail">sản phẩm</th>
                                <th class="product-price">đơn giá</th>
                                <th class="product-quantity">số lượng</th>
                                <th class="product-subtotal">tổng tiền</th>
                                <th class="product-remove">xóa</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- tr -->
                            <tr>
                                <td class="product-thumbnail">
                                    <div class="pro-thumbnail-img">

                                    </div>
                                    <div class="pro-thumbnail-info text-left">
                                        <h6 class="product-title-2">
                                            <a href="#"></a>
                                        </h6>
                                    </div>
                                </td>
                                <td class="product-price"></td>
                                <td class="product-quantity">
                                </td>
                                <td class="product-subtotal"></td>
                                <td class="product-remove">
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="row">
                    <div class="col-md-6" style="float:right">
                        <div class="payment-details box-shadow p-30 mb-50">
                            <h6 class="widget-title border-left mb-20">thanh toán</h6>
                            <table>
                                <tbody>
                                    <tr>
                                        <td class="td-title-1">Tạm tính</td>
                                        <td class="td-title-2">0 VND</td>
                                    </tr>
                                    <tr>
                                        <td class="td-title-1">Phí vận chuyển</td>
                                        <td class="td-title-2">0 VND</td>
                                    </tr>
                                    <tr>
                                        <td class="td-title-1">VAT</td>
                                        <td class="td-title-2">10%</td>
                                    </tr>
                                    <tr>
                                        <td class="order-total">Tổng thành tiền</td>
                                        <td class="order-total-price">0 VND</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- shopping-cart end -->
}
else
{
    <!-- shopping-cart start -->
    <div class="tab-pane active" id="shopping-cart">
        <div class="shopping-cart-content">
            <form action="#">
                <div class="table-content table-responsive mb-50">
                    <table class="text-center">
                        <thead>
                            <tr>
                                <th class="product-thumbnail">sản phẩm</th>
                                <th class="product-price">đơn giá</th>
                                <th class="product-quantity">số lượng</th>
                                <th class="product-subtotal">thành tiền</th>
                                <th class="product-remove">xóa</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- tr -->
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td class="product-thumbnail">
                                        <div class="pro-thumbnail-img">
                                            <img src="@Url.Content("~/Content/ProductImages/"+ item.HinhAnh)" alt="Hình sản phẩm">
                                        </div>
                                        <div class="pro-thumbnail-info text-left">
                                            <h6 class="product-title-2">
                                                <a href="#">@item.TenSp</a>
                                            </h6>
                                        </div>
                                    </td>
                                    <td class="product-price"  >@item.DonGia.ToString("#,##") VND</td>
                                    <td id="masp" hidden="hidden">@item.MaSP</td>
                                    <td id="dongia" hidden="hidden">@item.DonGia</td>
                                    <td class="product-quantity">
                                        <div class="cart-dec-inc">
                                            <div class="dec button" id="button">-</div>
                                            <input type="text" value="@item.SoLuong" name="button" class="cart-plus-minus-box" id="soluong" readonly="readonly">
                                            <div class="inc button" id="button">+</div>
                                        </div>
                                    </td>
                                    <td class="product-subtotal" id="thanhtien">@item.ThanhTien.ToString("#,##") VND</td>
                                    <td class="product-remove">
                                        @*<a href="" id="remove"><i class="zmdi zmdi-close"></i></a>*@
                                        <p>@Html.ActionLink(" ", "XoaGioHang", new { @MaSP = item.MaSP }, new { @class = "zmdi zmdi-close" })</p>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <div class="row">
                    <div class="col-md-6" style="float:right">
                        <div class="payment-details box-shadow p-30 mb-50">
                            <h6 class="widget-title border-left mb-20">thanh toán</h6>
                            <table >
                                <tbody>
                                    <tr>
                                        <td class="td-title-1" >Tạm tính</td>
                                        <td class="td-title-2" id="tamtinh">0 VND</td>
                                    </tr>
                                    <tr>
                                        <td class="td-title-1">Phí vận chuyển (chưa tính)</td>
                                        <td class="td-title-2">0 VND</td>
                                    </tr>
                                    <tr>
                                        <td class="td-title-1">VAT</td>
                                        <td class="td-title-2">10%</td>
                                    </tr>
                                    <tr>
                                        <td class="order-total">Tổng thành tiền</td>
                                        <td class="order-total-price" id="tongthanhtien">0 VND</td>
                                    </tr>
                                </tbody>
                            </table>
                            <button class="submit-btn-1 mt-20 btn-hover-1">Tiếp theo<a href="#checkout"></a></button>
                            @*<a href="#checkout" class="submit-btn-1 mt-20 btn-hover-1" data-toggle="tab">Tiếp theo</a>*@
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- shopping-cart end -->
}
<script type="text/javascript">
    jQuery(function ($) {
        $.ajax({
            type: "POST",
            data: {},
            url: '@Url.Content("TamTinh")',
            success: function (ketqua) {
                $('#tamtinh').html(ketqua);
                $.ajax({
                    type: "POST",
                    data: {},
                    url: '@Url.Content("TongThanhTien")',
                    success: function (ketqua) {
                        $('#tongthanhtien').html(ketqua);
                    }
                })
            }
        })
    });
   //Hàm tính thành tiền từng sp khi tăng số lượng, và thay đổi số lượng trên icon giỏ hàng
    $(".button").click( function () {
        var $button = $(this);
        var oldValue = $button.parent().find("input").val();
        //alert($.isNumeric(oldValue));
        if ($.isNumeric(oldValue)) {
            if ($button.text() == "+") {
                var newVal = parseFloat(oldValue) + 1;
            }
            else {
                // Don't allow decrementing below zero
                if (oldValue > 0) {
                    var newVal = parseFloat(oldValue) - 1;
                }
                else {
                    newVal = 0;
                }
            }
            $button.parent().find("input").val(newVal);
            var maSP = $button.parent().parent().siblings("#masp").html();
            var donGia = $button.parent().parent().siblings("#dongia").html();
            var soLuong = $button.parent().find("input").val();
            $.ajax({
                type: "GET",
                data: { masp: maSP, dongia: donGia, soluong: soLuong },
                url: '@Url.Content("TinhItemThanhTien")',
                success: function (ketqua) {
                    $button.parent().parent().siblings('#thanhtien').html(ketqua);
                    $.ajax({
                        type: "POST",
                        data: {},
                        UpdateTargetId:"giohang",
                        url: '@Url.Content("CapNhatGioHang")',
                        success: function (ketqua) {
                            $('#giohang_partial_holder').html(ketqua);
                            $.ajax({
                                type: "POST",
                                data: {},
                                url: '@Url.Content("TamTinh")',
                                success: function (ketqua) {
                                    $('#tamtinh').html(ketqua);
                                    $.ajax({
                                        type: "POST",
                                        data: {},
                                        url: '@Url.Content("TongThanhTien")',
                                        success: function (ketqua) {
                                            $('#tongthanhtien').html(ketqua);
                                        }
                                    })
                                }
                            })
                        }
                    })
                }
            })
        }
    });

</script>
